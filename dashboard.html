<!DOCTYPE html>
<html>
<head>
    <title>ğŸ”‘ Admin Key Manager - bintang657</title>
    <style>
        body { font-family: Arial; max-width: 700px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 150px; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; }
        button { background: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .keys-display { background: #e8f5e8; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .api-url { background: #e3f2fd; padding: 15px; border-radius: 8px; word-break: break-all; font-family: monospace; }
        #status { padding: 15px; border-radius: 8px; margin: 10px 0; display: none; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”‘ Admin Key Manager</h1>
        <p><strong>Repo:</strong> bintang657/admin-login</p>
        
        <!-- Tampilkan keys saat ini -->
        <div id="currentKeys" class="keys-display">
            <strong>ğŸ“‹ Keys Aktif (Live dari GitHub):</strong><br>
            <div id="keysList">Loading...</div>
        </div>
        
        <!-- Edit keys -->
        <h3>âœï¸ Edit Keys Baru (satu key per baris):</h3>
        <textarea id="keyInput" placeholder="admin-2026-key123
bot-master-v1
ff-admin-2026">admin-2026-key123
bot-master-v1</textarea>
        
        <br>
        <button onclick="updateKeys()">ğŸ’¾ Update keys.json di GitHub</button>
        <button onclick="generateKey()">ğŸ² Generate Random Key</button>
        
        <!-- Status -->
        <div id="status"></div>
        
        <!-- API Test -->
        <div class="api-url">
            <strong>âœ… RAW URL APK:</strong><br>
            <code>https://raw.githubusercontent.com/bintang657/admin-login/refs/heads/main/keys.json</code><br><br>
            <strong>ğŸ§ª Test API:</strong><br>
            <button onclick="testFirstKey()">Test Key Pertama</button>
            <span id="apiResult"></span>
        </div>
    </div>

    <script>
        const RAW_URL = 'https://raw.githubusercontent.com/bintang657/admin-login/refs/heads/main/keys.json';
        
        // Load keys saat buka halaman
        async function loadKeys() {
            try {
                const response = await fetch(RAW_URL);
                const data = await response.json();
                const keys = data.active_keys || [];
                document.getElementById('keysList').innerHTML = keys.map(k => `âœ… ${k}`).join('<br>');
                document.getElementById('keyInput').value = keys.join('
');
            } catch(e) {
                document.getElementById('keysList').innerHTML = 'âŒ Error loading keys.json';
            }
        }
        
        // Update keys ke GitHub
        async function updateKeys() {
            const keys = document.getElementById('keyInput').value.split('
')
                .map(k => k.trim()).filter(k => k.length > 0);
            const data = {
                active_keys: keys,
                last_update: new Date().toLocaleString('id-ID')
            };
            
            const token = prompt('Masukkan GitHub Token (Settings â†’ Developer settings â†’ Personal access tokens):');
            if (!token) return;
            
            try {
                showStatus('â³ Updating...', 'success');
                
                const apiUrl = 'https://api.github.com/repos/bintang657/admin-login/contents/keys.json';
                const existing = await fetch(apiUrl, { headers: { 'Authorization': `token ${token}` } });
                const fileData = await existing.json();
                
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Update keys (${keys.length} keys)`,
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(data)))),
                        sha: fileData.sha
                    })
                });
                
                if (response.ok) {
                    showStatus('âœ… SUCCESS! keys.json diupdate!', 'success');
                    loadKeys();
                } else {
                    throw new Error('Update gagal');
                }
            } catch(e) {
                showStatus('âŒ Error: ' + e.message, 'error');
            }
        }
        
        function generateKey() {
            const newKey = 'key-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now().toString().slice(-4);
            const current = document.getElementById('keyInput').value;
            document.getElementById('keyInput').value = current + '
' + newKey;
            showStatus(`ğŸ² New key: ${newKey}`, 'success');
        }
        
        async function testFirstKey() {
            const firstKey = document.getElementById('keyInput').value.split('
')[0]?.trim();
            if (!firstKey) return showStatus('âŒ Belum ada key!', 'error');
            
            try {
                const response = await fetch(RAW_URL);
                const data = await response.json();
                const valid = data.active_keys.includes(firstKey);
                document.getElementById('apiResult').innerHTML = valid ? 'âœ… VALID!' : 'âŒ INVALID';
                showStatus(valid ? 'âœ… Key valid di GitHub!' : 'âŒ Key tidak ditemukan', valid ? 'success' : 'error');
            } catch(e) {
                showStatus('âŒ API error', 'error');
            }
        }
        
        function showStatus(msg, type) {
            const status = document.getElementById('status');
            status.textContent = msg;
            status.className = type;
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 4000);
        }
        
        // Auto load
        loadKeys();
    </script>
</body>
</html>
